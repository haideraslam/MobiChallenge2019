#WHAT IT DOES
This simulator takes a route file as input and sends iot telemetry to azure iot hub. 
Sample route files have been provided with this project. Route file can be generated by drawing a route on https://www.google.com/maps/d/ and exporting to KML, then manually fix the format.

#HHOW TO RUN
##One time setup
Ensure dotnet core is installed on your machine. Run dotnet --version to verify.
If its not, please install from: https://www.microsoft.com/net/download/all

##Run in dev mode
PART 1 - Get dependencies
`cd vehicle-simulator`
`dotnet restore`

PART 2 - Execute the application
`dotnet run <args>`

This application takes 7 args. Yes, that many!
1. Vin 
2. currentMilage : The initial milage of car
3. initMoving : (0/1) Set this to 0 please if you want to be happy!
4. avgMilesPerHour: The average speed this car will give for all combined trips. it will vary around this number in telemetary.
5. hardBreakProbability: 1-00 : Number of times per 100 this car should simulate a hard break.
6. carAvgFuelConsumptionRate: average fuel consumption rate this car will give for all combined trips.It will vary around this average in telemetary.
7. connectionString: Device connection string in IoT hub
8. routeFilePath: Path for routes.txt file with route in this format: "lat,lon|lat,lon|lat.lon". A sample file is included in this project

##Example run command for local machine:
dotnet run WP0ZZZ99ZJS167001 778 0 100 10 23 "HostName=iot-hub-mobi.azure-devices.net;DeviceId=WP0ZZZ99ZJS167001;SharedAccessKey=Z1eoutnDcKzSsFPhy7oUB4sEfP4Zqcye1/JHE8AaNkI=" "C:\Users\qureshih2\workspace\iot\vehicle-simulator\route.txt"

dotnet run WP0ZZZ99ZJS167005 20000 0 50 50 23 "HostName=iot-hub-mobi.azure-devices.net;DeviceId=WP0ZZZ99ZJS167005;SharedAccessKey=1feCMX+LTa77uXMdNiH6KnrwnlgLX7OtzxPLR1JB6C4=" "C:\Users\qureshih2\workspace\iot\vehicle-simulator\route.txt"

#CONTAINERIZATION(for local or prod):
## Build container
`docker build -t innovationlab/simulateddevice .`

## Run Container
All the args are passed in as environment varaibles to the container.
Sample:

`docker run --env VIN=WP0ZZZ99ZJS167005 --env MILAGE=20000 --env MOVING=0 --env AVG_MILES_P_HOUR=85 --env HBREAK_PROB=1
--env AVG_FUEL_CONS=20 --env CONN_STR='HostName=iot-hub-mobi.azure-devices.net;DeviceId=WP0ZZZ99ZJS167005;SharedAccessKey=1feCMX+LTa77uXMdNiH6KnrwnlgLX7OtzxPLR1JB6C4=' --env ROUTE_FILE='/app/route.txt' innovationlab/simulateddevice`

## Run 5 containers with cars on different routes
`docker-compose up`